{% extends 'base.html.twig' %}
 
{% block body %} 
<style>
  .container {
  position: relative;
  text-align: center;
  color: white;
} 
.centered {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
</style>
<div class="row"  style="padding-top: 10px">
<div class="col"></div>
 <div class="col-10 shadow p-3 mb-5 bg-white rounded">
    <div class="text-center my-5">
      <h1 class="display-3">{{ albumInfo.name }} </h1>
       
      <hr><input id="remember" name="remember" type="checkbox" onclick="validate()" /> Selecionar multiplas imagens
    </div>

 <div class="container-fluid">
                     <div class="row">
                     {% set cont = 0 %}
                      {% set loopC = 0 %}
                     {% set apl = (album.items|length / 5)|round %}
                      {% if album.items|length < 5 %}
                  {% set apl = (album.items|length / 5)|round(0,'floor') %}
                    {% endif %}
            {% for postagem in album.items %}
           {% set loopC = loopC + 1 %}
             {% if cont == 0 %}
         <div class="column">
            {% endif %}
            <div class="container" onclick="getId({{postagem.id}})">
            
                                <img src="{{ '/uploads/' ~ postagem.imagem }}" id="{{postagem.id}}" >
                                <div class="centered"  id="sel{{postagem.id}}" style="visibility: hidden;"><h3>Selecionado</h3></div> 
                                </div>
         
           
            {% if cont == apl %}
           {% set cont = 0 %}
           {% else %}
            {% set cont = cont + 1 %}
            {% endif %}
             {% if cont == 0 or loopC == (album.items|length) %}
              </div> 
            {% endif %}
             
            {% endfor %}   
             </div>
           
            </div>
            <hr>
     <div class="row">
    <div class="col-sm-5">
    </div>
    <div class="col-sm-7">
    <div class="navigation" >
            {{ knp_pagination_render(album) }}
        </div>
        </div>
        <div class="col-sm-1">
        </div>
        </div>
        </div>
<div class="col"></div>
</div>

          <nav class="navbar fixed-bottom navbar-light bg-light" id="navbarFooterUser" style="visibility: hidden;">
  <div class="container-fluid">
    <button id = "navBut" type="button" class="btn btn-primary">Adicionar ao meu album</button>
  </div>
</nav>
{% block javascripts %}
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
let ids = [];
window.onload = function() {
validate();
} 
  function swalSelect(data){
       var options = {};
        $.map(data,
            function(o) {
                options[o.id] = o.name;
            });
      console.log(data)
 const { value: album } =  Swal.fire({
  title: 'Selecione o album a salvar as imagens',
  input: 'select',
  inputOptions: options,
  inputPlaceholder: 'Selecione um album',
  showCancelButton: true,
  inputValidator: (value) => {
    console.log("oiii")
    return new Promise((resolve) => {
     
      $.post('{{ path("album.api_post_album")}}',
  {
        album: value,
        images: ids
  },
  function(data, status){
    alert("Data: " + data + "\nStatus: " + status);
  });
    })
  }
})
 }
$(document).ready(function(){   
         $("#navBut").click( function(){  
              //console.log("jesus")
            $.ajax({  
               url:        '{{ path("album.getAlbums")}}',  
               type:       'GET',   
               dataType:   'json',  
               async:      true,  
               
               success: function(data, status) {       
                  for(i = 0; i < data.length; i++) {  
                     student = data[i];  
                     console.log(data[i])
                  }  
                   swalSelect(data)
               },  
               error : function(xhr, textStatus, errorThrown) {  
                  alert('Ajax request failed.');  
               }  
            });  
         });  
      });

function validate(){
    if(document.getElementById('remember').checked){
     document.getElementById('navbarFooterUser').style.visibility = 'visible';
    }else{
         document.getElementById('navbarFooterUser').style.visibility = 'hidden';
         ids.forEach(element => {
            document.getElementById(element).style.filter = "grayscale(0) brightness(1)";
      document.getElementById("sel"+element).style.visibility  = 'hidden';
         }) 
         ids = []
    }
}

function getId(id){
    if(document.getElementById('remember').checked){
         
    if(ids.find(element=> element == id)){
     document.getElementById(id).style.filter = "grayscale(0) brightness(1)";
      document.getElementById("sel"+id).style.visibility  = 'hidden'
     var index = ids.indexOf(id);
    if (index !== -1) {
     ids.splice(index, 1);
} 
     }else{
           ids.push(id);
     document.getElementById(id).style.filter ="grayscale(1) brightness(0.5)" 
     document.getElementById("sel"+id).style.visibility  = 'visible'
    console.log(ids)
     }
    }
}
 
</script>
{% endblock %}
{% endblock %} 